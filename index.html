<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculator with Claude AI & History</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fff6fe;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px;
      gap: 20px;
      flex-wrap: wrap;
    }

    .calculator {
      background: #ffffff;
      width: 100%;
      max-width: 320px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      overflow: hidden;
    }

    .side-panel {
      background: #ffffff;
      width: 100%;
      max-width: 400px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      overflow: hidden;
    }

    .panel-tabs {
      display: flex;
      background: #f0f0f0;
      border-bottom: 2px solid #dc6bba;
    }

    .panel-tab {
      flex: 1;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      font-weight: 600;
      color: #666;
      transition: all 0.3s;
    }

    .panel-tab.active {
      background: #ffffff;
      color: #dc6bba;
    }

    .panel-content {
      display: none;
      padding: 20px;
      height: 600px;
      overflow-y: auto;
    }

    .panel-content.active {
      display: flex;
      flex-direction: column;
    }

    .chat-area {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 15px;
      padding: 10px;
      background: #fafafa;
      border-radius: 8px;
      min-height: 400px;
    }

    .message {
      margin-bottom: 12px;
      padding: 10px 14px;
      border-radius: 12px;
      max-width: 85%;
      word-wrap: break-word;
      line-height: 1.5;
    }

    .user-message {
      background: #dc6bba;
      color: white;
      margin-left: auto;
      text-align: right;
    }

    .ai-message {
      background: #fcdcf9;
      color: #333;
    }

    .loading {
      background: #fcdcf9;
      padding: 10px 14px;
      border-radius: 12px;
      max-width: 85%;
      font-style: italic;
      color: #666;
    }

    .input-area {
      display: flex;
      gap: 10px;
    }

    .ai-input {
      flex: 1;
      padding: 12px;
      border: 2px solid #dc6bba;
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Segoe UI', sans-serif;
      outline: none;
    }

    .ai-input:focus {
      border-color: #a34582;
    }

    .send-btn {
      padding: 12px 16px;
      background: #dc6bba;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .send-btn:hover {
      background: #c95aa7;
    }

    .send-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .equation-solver {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .equation-input-section {
      background: #fafafa;
      padding: 15px;
      border-radius: 8px;
    }

    .equation-input-section h3 {
      margin-bottom: 10px;
      color: #333;
      font-size: 16px;
    }

    .equation-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #dc6bba;
      border-radius: 8px;
      font-size: 16px;
      font-family: 'Courier New', monospace;
      outline: none;
    }

    .equation-examples {
      margin-top: 10px;
      font-size: 12px;
      color: #666;
    }

    .equation-examples div {
      margin-top: 5px;
    }

    .solve-btn {
      width: 100%;
      padding: 15px;
      background: #a34582;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      font-size: 16px;
      transition: all 0.2s;
    }

    .solve-btn:hover {
      background: #8f3b71;
    }

    .solve-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .solution-area {
      background: #fafafa;
      padding: 15px;
      border-radius: 8px;
      min-height: 200px;
    }

    .solution-area h3 {
      margin-bottom: 10px;
      color: #333;
      font-size: 16px;
    }

    .solution-content {
      font-size: 14px;
      line-height: 1.6;
      color: #333;
      white-space: pre-wrap;
    }

    .combined-history {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .history-section {
      background: #fafafa;
      padding: 15px;
      border-radius: 8px;
    }

    .history-section h3 {
      font-size: 16px;
      margin-bottom: 15px;
      color: #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .clear-btn {
      background: #dc6bba;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    .clear-btn:hover {
      background: #c95aa7;
    }

    .history-item, .memory-item {
      background: white;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      border-left: 4px solid #dc6bba;
      cursor: pointer;
      transition: all 0.2s;
    }

    .history-item:hover, .memory-item:hover {
      background: #ffe6fc;
      transform: translateX(5px);
    }

    .history-expression {
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
    }

    .history-result {
      font-size: 20px;
      color: #333;
      font-weight: 600;
    }

    .no-history, .no-memory {
      color: #888;
      text-align: center;
      padding: 20px;
      font-size: 14px;
    }

    .header {
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .mode {
      font-size: 14px;
      font-weight: 600;
      color: #333;
    }

    .history-toggle {
      background: #dc6bba;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.2s;
    }

    .history-toggle:hover {
      background: #c95aa7;
    }

    .display-area {
      padding: 20px 16px;
      text-align: right;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      background: #fafafa;
    }

    .history-text {
      color: #888;
      font-size: 14px;
      margin-bottom: 8px;
      min-height: 20px;
    }

    .display {
      background: transparent;
      border: none;
      color: #000;
      font-size: 48px;
      font-weight: 600;
      text-align: right;
      width: 100%;
      outline: none;
    }

    .memory-buttons {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 1px;
      padding: 8px 0;
      background: #f0f0f0;
    }

    .memory-btn {
      background: #ffffff;
      border: none;
      color: #666;
      font-size: 13px;
      padding: 10px;
      cursor: pointer;
      font-family: 'Segoe UI', sans-serif;
      transition: all 0.2s;
    }

    .memory-btn:hover {
      background: #ffe6fc;
      color: #dc6bba;
    }

    .memory-btn:active {
      background: #fcdcf9;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1px;
      padding: 0;
      background: #e0e0e0;
    }

    button {
      height: 60px;
      font-size: 20px;
      border: none;
      cursor: pointer;
      background: #fcdcf9;
      color: #000;
      font-family: 'Segoe UI', sans-serif;
      transition: all 0.2s;
      font-weight: 500;
    }

    button:hover {
      filter: brightness(0.95);
    }

    button:active {
      filter: brightness(0.85);
      transform: scale(0.98);
    }

    button.function {
      background: #fcdcf9;
      color: #000;
      font-size: 18px;
    }

    button.operator {
      background: #dc6bba;
      color: #fff;
      font-size: 24px;
      font-weight: 600;
    }

    button.number {
      background: #fcdcf9;
      font-size: 24px;
    }

    button.equal {
      background: #a34582;
      color: white;
      font-size: 24px;
      font-weight: 700;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.4; }
      50% { opacity: 1; }
    }

    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      
      .calculator, .side-panel {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="calculator">
    <div class="header">
      <div class="mode">Standard</div>
      <button class="history-toggle" id="historyToggle">üíæ Memory</button>
    </div>

    <div class="display-area">
      <div class="history-text" id="history">&nbsp;</div>
      <input type="text" class="display" id="display" value="0" readonly>
    </div>

    <div class="memory-buttons">
      <button class="memory-btn" id="mc">MC</button>
      <button class="memory-btn" id="mr">MR</button>
      <button class="memory-btn" id="mAdd">M+</button>
      <button class="memory-btn" id="mSub">M‚àí</button>
      <button class="memory-btn" id="ms">MS</button>
    </div>

    <div class="buttons">
      <button class="function" id="percent">%</button>
      <button class="function" id="ce">CE</button>
      <button class="function" id="clear">C</button>
      <button class="function" id="back">‚å´</button>

      <button class="function" id="recip">¬π‚ÅÑ‚Çì</button>
      <button class="function" id="square">x¬≤</button>
      <button class="function" id="sqrt">¬≤‚àöx</button>
      <button class="operator" id="divide">√∑</button>

      <button class="number" id="n7">7</button>
      <button class="number" id="n8">8</button>
      <button class="number" id="n9">9</button>
      <button class="operator" id="multiply">√ó</button>

      <button class="number" id="n4">4</button>
      <button class="number" id="n5">5</button>
      <button class="number" id="n6">6</button>
      <button class="operator" id="subtract">‚àí</button>

      <button class="number" id="n1">1</button>
      <button class="number" id="n2">2</button>
      <button class="number" id="n3">3</button>
      <button class="operator" id="add">+</button>

      <button class="function" id="negate">+/‚àí</button>
      <button class="number" id="n0">0</button>
      <button class="number" id="decimal">.</button>
      <button class="equal" id="equals">=</button>
    </div>
  </div>

  <div class="side-panel">
    <div class="panel-tabs">
      <div class="panel-tab active" data-tab="chatgpt">üí¨ AI Assistant</div>
      <div class="panel-tab" data-tab="equation">üìê Equations</div>
      <div class="panel-tab" data-tab="history">üìã History</div>
    </div>

    <div class="panel-content active" id="chatgptPanel">
      <div class="chat-area" id="chatArea">
        <div class="message ai-message">
          <strong>üëã Hi! I'm Claude, your comprehensive AI math assistant.</strong>
          <p style="margin-top: 8px; font-size: 14px;">I can help you with:</p>
          <ul style="margin-top: 5px; margin-left: 20px; font-size: 13px;">
            <li>Explaining ANY math concept (prime numbers, fractions, algebra, calculus, etc.)</li>
            <li>Solving complex math problems step-by-step</li>
            <li>Teaching mathematical concepts with examples</li>
            <li>Answering questions like "What is...?" or "How does...?"</li>
            <li>Checking your work and explaining calculations</li>
          </ul>
          <p style="margin-top: 8px; font-size: 13px; color: #666;">Try asking: "What are prime numbers?", "Explain the Pythagorean theorem", "What is calculus?", or any math question!</p>
        </div>
      </div>
      <div class="input-area">
        <input type="text" id="aiInput" class="ai-input" placeholder="Ask me: What are prime numbers? What is calculus?" />
        <button class="send-btn" id="sendBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="panel-content" id="equationPanel">
      <div class="equation-solver">
        <div class="equation-input-section">
          <h3>Enter Your Equation:</h3>
          <input type="text" id="equationInput" class="equation-input" placeholder="Example: 2x + 5 = 13" />
          <div class="equation-examples">
            <strong>Examples:</strong>
            <div>‚Ä¢ Linear: 2x + 5 = 13</div>
            <div>‚Ä¢ Quadratic: x^2 - 5x + 6 = 0</div>
            <div>‚Ä¢ Multiple variables: 2x + 3y = 12 and x - y = 1</div>
          </div>
        </div>

        <button class="solve-btn" id="solveBtn">Solve with AI</button>

        <div class="solution-area">
          <h3>Solution:</h3>
          <div class="solution-content" id="solutionContent">
            Enter an equation above and click "Solve with AI" to see the step-by-step solution!
          </div>
        </div>
      </div>
    </div>

    <div class="panel-content" id="historyPanel">
      <div class="combined-history">
        <div class="history-section">
          <h3>
            Calculation History
            <button class="clear-btn" id="clearHistoryBtn">Clear</button>
          </h3>
          <div id="historyList">
            <div class="no-history">No calculations yet</div>
          </div>
        </div>

        <div class="history-section">
          <h3>
            Memory
            <button class="clear-btn" id="clearMemoryBtn">Clear</button>
          </h3>
          <div id="memoryList">
            <div class="no-memory">No memory stored</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentVal = '0';
    let previousVal = null;
    let operator = null;
    let waitingForOperand = false;
    let memoryVal = 0;
    let lastCalculation = '';
    let calculationHistory = [];
    // Comprehensive Math Knowledge Base
    const mathKnowledge = {
      // Basic Concepts
      "prime numbers": "Prime numbers are natural numbers greater than 1 that have no positive divisors other than 1 and themselves. Examples include 2, 3, 5, 7, 11, 13, 17, 19, 23, and so on. The number 2 is the only even prime number. Prime numbers are fundamental in number theory and have applications in cryptography and computer science.",
      
      "fractions": "A fraction represents a part of a whole. It consists of a numerator (top number) and denominator (bottom number). For example, 3/4 means 3 parts out of 4 equal parts. To add fractions, you need a common denominator. To multiply, multiply the numerators and denominators separately. Fractions can be converted to decimals by dividing the numerator by the denominator.",
      
      "decimals": "Decimals are another way to represent fractions and parts of whole numbers. The decimal point separates the whole number part from the fractional part. Each position after the decimal represents tenths, hundredths, thousandths, etc. For example, 0.5 = 1/2, 0.25 = 1/4, and 0.75 = 3/4.",
      
      "percentages": "A percentage is a way of expressing a number as a fraction of 100. The symbol % means 'per hundred'. For example, 50% means 50 out of 100, which equals 0.5 or 1/2. To convert a decimal to a percentage, multiply by 100. To convert a percentage to a decimal, divide by 100.",
      
      "even numbers": "Even numbers are integers that are divisible by 2 with no remainder. Examples: 2, 4, 6, 8, 10, 12, etc. Even numbers end in 0, 2, 4, 6, or 8. When you add two even numbers, you always get an even number. When you multiply any number by an even number, the result is even.",
      
      "odd numbers": "Odd numbers are integers that are not divisible by 2. Examples: 1, 3, 5, 7, 9, 11, etc. Odd numbers end in 1, 3, 5, 7, or 9. When you add two odd numbers, you get an even number. When you multiply two odd numbers, you get an odd number.",
      
      "integers": "Integers are whole numbers that can be positive, negative, or zero. Examples: ..., -3, -2, -1, 0, 1, 2, 3, ... They do not include fractions or decimals. Integers are used for counting, ordering, and measuring discrete quantities.",
      
      "rational numbers": "Rational numbers are numbers that can be expressed as a fraction a/b where a and b are integers and b ‚â† 0. All integers, fractions, and terminating or repeating decimals are rational numbers. Examples: 1/2, 3, -4, 0.75, 0.333...",
      
      "irrational numbers": "Irrational numbers cannot be expressed as a simple fraction. Their decimal representation goes on forever without repeating. Famous examples include œÄ (pi ‚âà 3.14159...), ‚àö2 (‚âà 1.41421...), and e (‚âà 2.71828...). These numbers are important in geometry and calculus.",
      
      // Algebra
      "algebra": "Algebra is a branch of mathematics that uses letters and symbols to represent numbers and quantities in formulas and equations. It helps us solve problems by finding unknown values. Key concepts include variables (like x and y), expressions, equations, and functions. Algebra is essential for advanced mathematics and many real-world applications.",
      
      "variables": "Variables are symbols (usually letters) that represent unknown or changeable values in mathematical expressions and equations. Common variables include x, y, z, a, b, and c. For example, in the equation 2x + 5 = 13, x is the variable we need to solve for. Variables allow us to write general formulas that work for many different values.",
      
      "equations": "An equation is a mathematical statement that shows two expressions are equal, connected by an equals sign (=). For example, 2x + 3 = 7 is an equation. Solving an equation means finding the value(s) of the variable(s) that make the equation true. You solve equations by performing the same operations on both sides to isolate the variable.",
      
      "polynomials": "A polynomial is an expression consisting of variables and coefficients combined using addition, subtraction, and multiplication. Examples: 3x + 2, x¬≤ - 5x + 6, 4x¬≥ + 2x¬≤ - x + 7. The degree of a polynomial is the highest power of the variable. Polynomials are classified as linear (degree 1), quadratic (degree 2), cubic (degree 3), etc.",
      
      "exponents": "An exponent (or power) tells you how many times to multiply a number by itself. In x^n, x is the base and n is the exponent. For example, 2¬≥ = 2 √ó 2 √ó 2 = 8. Special rules: x‚Å∞ = 1, x¬π = x, x^(-n) = 1/x^n. Exponents are used in scientific notation, compound interest, and exponential growth.",
      
      "logarithms": "A logarithm is the inverse operation of exponentiation. If b^y = x, then log_b(x) = y. Common logarithms use base 10 (log), while natural logarithms use base e (ln). Logarithms help solve equations where the unknown is in an exponent. They're used in science for measuring sound (decibels), earthquakes (Richter scale), and pH levels.",
      
      "quadratic equations": "A quadratic equation has the form ax¬≤ + bx + c = 0, where a ‚â† 0. Solutions can be found using: 1) Factoring, 2) Completing the square, or 3) The quadratic formula: x = (-b ¬± ‚àö(b¬≤ - 4ac)) / 2a. The discriminant (b¬≤ - 4ac) tells us: if positive, two real solutions; if zero, one solution; if negative, no real solutions (two complex solutions).",
      
      "functions": "A function is a relation that assigns exactly one output for each input. Written as f(x), where x is the input and f(x) is the output. For example, f(x) = 2x + 1 means you multiply the input by 2 and add 1. Functions are fundamental in mathematics and model relationships between quantities in science, economics, and engineering.",
      
      // Geometry
      "geometry": "Geometry is the branch of mathematics that studies shapes, sizes, positions, and properties of space. It includes points, lines, angles, surfaces, and solids. Geometry has two main branches: plane geometry (2D shapes like circles and triangles) and solid geometry (3D shapes like spheres and cubes). It's essential in architecture, engineering, art, and physics.",
      
      "pythagorean theorem": "The Pythagorean theorem states that in a right triangle, the square of the hypotenuse (longest side) equals the sum of squares of the other two sides: a¬≤ + b¬≤ = c¬≤. This theorem, discovered by ancient Greek mathematician Pythagoras, is fundamental in geometry and has countless applications in construction, navigation, computer graphics, and physics.",
      
      "angles": "An angle is formed when two rays meet at a common point (vertex). Angles are measured in degrees (¬∞) or radians. Types include: acute (less than 90¬∞), right (exactly 90¬∞), obtuse (between 90¬∞ and 180¬∞), straight (180¬∞), and reflex (greater than 180¬∞). The sum of angles in a triangle is always 180¬∞.",
      
      "triangles": "A triangle is a polygon with three sides and three angles. Types include: equilateral (all sides equal), isosceles (two sides equal), scalene (no sides equal), right (one 90¬∞ angle), acute (all angles less than 90¬∞), and obtuse (one angle greater than 90¬∞). The area of a triangle is (base √ó height) / 2.",
      
      "circles": "A circle is a shape where all points are equidistant from a center point. Key measurements: radius (r) is the distance from center to edge, diameter (d = 2r) is the distance across through the center, circumference (C = 2œÄr or œÄd) is the distance around, and area (A = œÄr¬≤). Circles are fundamental in wheels, gears, orbits, and many natural phenomena.",
      
      "pi": "Pi (œÄ) is a mathematical constant approximately equal to 3.14159. It represents the ratio of a circle's circumference to its diameter. This ratio is the same for all circles, regardless of size. œÄ is an irrational number (its decimals never end or repeat). It's used extensively in geometry, trigonometry, physics, and engineering.",
      
      "area": "Area measures the size of a 2D surface, expressed in square units (like cm¬≤, m¬≤, etc.). Common formulas: Rectangle = length √ó width, Square = side¬≤, Triangle = (base √ó height) / 2, Circle = œÄr¬≤, Trapezoid = ((base‚ÇÅ + base‚ÇÇ) √ó height) / 2. Area is used in construction, land measurement, and many practical applications.",
      
      "volume": "Volume measures the space occupied by a 3D object, expressed in cubic units (like cm¬≥, m¬≥, etc.). Common formulas: Cube = side¬≥, Rectangular prism = length √ó width √ó height, Cylinder = œÄr¬≤h, Sphere = (4/3)œÄr¬≥, Cone = (1/3)œÄr¬≤h. Volume is essential in engineering, chemistry, and everyday measurements.",
      
      "perimeter": "Perimeter is the total distance around the outside of a 2D shape. For regular shapes: Rectangle = 2(length + width), Square = 4 √ó side, Triangle = sum of all three sides. For a circle, the perimeter is called circumference = 2œÄr. Perimeter is used in fencing, framing, and measuring boundaries.",
      
      // Trigonometry
      "trigonometry": "Trigonometry studies the relationships between angles and sides of triangles. The main functions are sine (sin), cosine (cos), and tangent (tan). In a right triangle: sin(Œ∏) = opposite/hypotenuse, cos(Œ∏) = adjacent/hypotenuse, tan(Œ∏) = opposite/adjacent. Trigonometry is crucial in navigation, engineering, physics, and astronomy.",
      
      "sine": "Sine (sin) is a trigonometric function. In a right triangle, sin(angle) = opposite side / hypotenuse. For any angle Œ∏, the sine value ranges from -1 to 1. The sine function creates a wave pattern and is used to model periodic phenomena like sound waves, light waves, and tides.",
      
      "cosine": "Cosine (cos) is a trigonometric function. In a right triangle, cos(angle) = adjacent side / hypotenuse. Like sine, cosine values range from -1 to 1. The cosine wave is identical to the sine wave but shifted by 90¬∞. It's used in physics, engineering, and signal processing.",
      
      "tangent": "Tangent (tan) is a trigonometric function. In a right triangle, tan(angle) = opposite side / adjacent side, which also equals sin(angle) / cos(angle). Unlike sine and cosine, tangent can have any value from negative to positive infinity. It's used to calculate slopes, angles of elevation, and in calculus.",
      
      // Calculus
      "calculus": "Calculus is the mathematical study of continuous change. It has two main branches: differential calculus (studying rates of change and slopes) and integral calculus (studying accumulation and areas). Invented independently by Newton and Leibniz in the 17th century, calculus is essential in physics, engineering, economics, statistics, and many scientific fields.",
      
      "derivatives": "A derivative measures how a function changes as its input changes - it's the rate of change or slope at any point. If f(x) represents position, f'(x) represents velocity. The derivative of x^n is nx^(n-1). Derivatives are used to find maximum and minimum values, optimize processes, and understand motion and change.",
      
      "integrals": "An integral is the reverse of a derivative. It represents accumulation or the area under a curve. There are definite integrals (with limits, giving a number) and indefinite integrals (giving a function). Integrals are used to calculate areas, volumes, total distance traveled, and accumulated quantities in physics and engineering.",
      
      "limits": "A limit describes the value a function approaches as the input approaches some value. Written as lim(x‚Üía) f(x). Limits are fundamental to calculus and help us understand behavior at points where a function might not be defined. They're used to define derivatives and integrals precisely.",
      
      // Statistics & Probability
      "statistics": "Statistics is the science of collecting, analyzing, interpreting, and presenting data. Key concepts include mean (average), median (middle value), mode (most frequent value), range, and standard deviation. Statistics helps us understand patterns, make predictions, and make informed decisions in science, business, medicine, and social sciences.",
      
      "mean": "The mean (or average) is calculated by adding all values and dividing by the number of values. For example, the mean of 2, 4, 6, 8, 10 is (2+4+6+8+10)/5 = 30/5 = 6. The mean represents the central tendency of data and is sensitive to outliers (extreme values).",
      
      "median": "The median is the middle value when data is arranged in order. For odd-sized datasets, it's the middle number. For even-sized datasets, it's the average of the two middle numbers. Unlike the mean, the median is not affected by extreme values, making it useful for skewed data like income levels.",
      
      "mode": "The mode is the value that appears most frequently in a dataset. A dataset can have one mode (unimodal), multiple modes (bimodal or multimodal), or no mode at all. For example, in the set {2, 3, 3, 5, 7, 7, 7, 9}, the mode is 7. The mode is useful for categorical data.",
      
      "probability": "Probability measures the likelihood of an event occurring, expressed as a number between 0 (impossible) and 1 (certain), or as a percentage. Basic probability = (favorable outcomes) / (total possible outcomes). For example, the probability of rolling a 6 on a fair die is 1/6 ‚âà 0.167 or about 16.7%.",
      
      // Number Theory
      "factors": "Factors are numbers that divide evenly into another number. For example, the factors of 12 are 1, 2, 3, 4, 6, and 12. Every number has at least two factors: 1 and itself. Prime numbers have exactly two factors. Finding factors is important in simplifying fractions and solving certain equations.",
      
      "multiples": "A multiple of a number is the product of that number and any integer. For example, multiples of 3 are 3, 6, 9, 12, 15, etc. Every number has infinite multiples. The least common multiple (LCM) of two numbers is the smallest number that is a multiple of both.",
      
      "greatest common divisor": "The greatest common divisor (GCD), also called greatest common factor (GCF), is the largest number that divides two or more numbers evenly. For example, the GCD of 12 and 18 is 6. Finding the GCD is useful for simplifying fractions and solving problems involving division.",
      
      "fibonacci sequence": "The Fibonacci sequence is a series where each number is the sum of the two preceding ones: 0, 1, 1, 2, 3, 5, 8, 13, 21, 34, ... This sequence appears in nature (flower petals, pinecones, shells), art, and architecture. The ratio of consecutive Fibonacci numbers approaches the golden ratio (œÜ ‚âà 1.618).",
      
      "perfect squares": "A perfect square is a number that can be expressed as the product of an integer with itself. Examples: 1 (1√ó1), 4 (2√ó2), 9 (3√ó3), 16 (4√ó4), 25 (5√ó5), etc. The square root of a perfect square is always an integer. Perfect squares are important in geometry and algebra.",
      
      "composite numbers": "Composite numbers are positive integers greater than 1 that have more than two factors. In other words, they can be divided evenly by numbers other than 1 and themselves. Examples: 4, 6, 8, 9, 10, 12, etc. Every composite number can be expressed as a product of prime numbers (prime factorization).",
      
      // Advanced Topics
      "matrices": "A matrix is a rectangular array of numbers arranged in rows and columns. Matrices are used to represent and solve systems of linear equations, transform graphics in computer games, analyze networks, and process data in machine learning. Matrix operations include addition, multiplication, and finding determinants and inverses.",
      
      "complex numbers": "Complex numbers have the form a + bi, where a and b are real numbers and i is the imaginary unit (i¬≤ = -1). They extend the real number system and are essential in advanced mathematics, electrical engineering, quantum mechanics, and signal processing. Every polynomial equation has solutions in complex numbers.",
      
      "vectors": "A vector is a quantity with both magnitude (size) and direction. Vectors are represented as arrows or as ordered lists of numbers. They're used in physics (force, velocity, acceleration), computer graphics (3D modeling), and engineering. Vector operations include addition, scalar multiplication, dot product, and cross product.",
      
      "series": "A series is the sum of the terms of a sequence. An arithmetic series has a constant difference between terms (e.g., 2, 5, 8, 11, ...). A geometric series has a constant ratio between terms (e.g., 2, 6, 18, 54, ...). Series are used in finance (compound interest), physics, and calculus (approximating functions).",
      
      // Operations
      "addition": "Addition combines numbers to find their total or sum. Symbol: +. It's commutative (a+b = b+a) and associative ((a+b)+c = a+(b+c)). Adding zero doesn't change a number (identity property). Addition is one of the four basic arithmetic operations and represents combining quantities.",
      
      "subtraction": "Subtraction finds the difference between two numbers. Symbol: ‚àí. It's the inverse of addition. Unlike addition, subtraction is neither commutative nor associative. Subtracting zero leaves a number unchanged. Subtraction represents taking away, comparing, or finding what's left.",
      
      "multiplication": "Multiplication is repeated addition. Symbol: √ó or ¬∑. For example, 3 √ó 4 = 4 + 4 + 4 = 12. It's commutative (a√ób = b√óa) and associative. Multiplying by 1 doesn't change a number (identity property). Multiplying by 0 always gives 0. Multiplication represents scaling, grouping, or finding area.",
      
      "division": "Division splits a number into equal parts. Symbol: √∑ or /. It's the inverse of multiplication. Division by zero is undefined (impossible). When you divide, the result might be a whole number, fraction, or decimal. Division represents sharing, grouping, or finding how many times one number fits into another.",
      
      "order of operations": "The order of operations (PEMDAS/BODMAS) tells us which calculations to do first: 1) Parentheses/Brackets, 2) Exponents/Orders, 3) Multiplication and Division (left to right), 4) Addition and Subtraction (left to right). For example, 2 + 3 √ó 4 = 2 + 12 = 14, not 20.",
      
      "absolute value": "The absolute value of a number is its distance from zero, always positive or zero. Symbol: |x|. For example, |5| = 5 and |-5| = 5. Absolute value removes the negative sign. It's used to measure distance, error, and magnitude regardless of direction.",
      
      "square root": "A square root of a number x is a value that, when multiplied by itself, gives x. Symbol: ‚àö. For example, ‚àö16 = 4 because 4 √ó 4 = 16. Every positive number has two square roots: one positive (principal root) and one negative. Square roots are inverse operations of squaring.",
      
      "powers": "A power (or exponent) indicates repeated multiplication. In a^n, a is the base and n is the exponent/power. For example, 2^4 = 2√ó2√ó2√ó2 = 16. Special cases: a^1 = a, a^0 = 1 (for a ‚â† 0), a^(-n) = 1/a^n. Powers are used in scientific notation, growth models, and computer science."
    };

    async function askChatGPT(question, isCalculation = false) {
      try {
        showLoading();
        
        let response = '';
        
        if (isCalculation) {
          // Handle calculation explanations
          response = explainCalculation(question);
        } else {
          // Handle general math questions
          response = answerMathQuestion(question);
        }
        
        // Add to conversation history for context
        conversationHistory.push({
          role: "user",
          content: question
        });
        conversationHistory.push({
          role: "assistant",
          content: response
        });
        
        // Keep history manageable
        if (conversationHistory.length > 12) {
          conversationHistory = conversationHistory.slice(-12);
        }
        
        setTimeout(() => {
          removeLoading();
          addMessage(response, false);
        }, 600);
        
      } catch (error) {
        console.error("Error:", error);
        removeLoading();
        addMessage("I'm here to help with math! Try asking about concepts like prime numbers, fractions, calculus, or any other math topic.", false);
      }
    }
    
    function answerMathQuestion(question) {
      const q = question.toLowerCase().trim();
      
      // Remove common question words to get key terms
      const cleanQ = q.replace(/^(what|explain|tell me about|describe|define|how does|how do|what are|what is)\s+/i, '')
                       .replace(/\?/g, '')
                       .trim();
      
      // Check for exact matches first
      if (mathKnowledge[cleanQ]) {
        return mathKnowledge[cleanQ];
      }
      
      // Check for partial matches
      for (let [key, value] of Object.entries(mathKnowledge)) {
        if (cleanQ.includes(key) || key.includes(cleanQ)) {
          return value;
        }
      }
      
      // Handle specific patterns
      if (q.includes('prime') && q.includes('number')) {
        return mathKnowledge["prime numbers"];
      }
      if (q.includes('fraction')) {
        return mathKnowledge["fractions"];
      }
      if (q.includes('percent') || q.includes('%')) {
        return mathKnowledge["percentages"];
      }
      if (q.includes('calculus')) {
        return mathKnowledge["calculus"];
      }
      if (q.includes('derivative')) {
        return mathKnowledge["derivatives"];
      }
      if (q.includes('integral')) {
        return mathKnowledge["integrals"];
      }
      if (q.includes('triangle')) {
        return mathKnowledge["triangles"];
      }
      if (q.includes('circle')) {
        return mathKnowledge["circles"];
      }
      if (q.includes('pythagorean')) {
        return mathKnowledge["pythagorean theorem"];
      }
      if (q.includes('algebra')) {
        return mathKnowledge["algebra"];
      }
      if (q.includes('geometry')) {
        return mathKnowledge["geometry"];
      }
      if (q.includes('statistics') || q.includes('stats')) {
        return mathKnowledge["statistics"];
      }
      if (q.includes('probability')) {
        return mathKnowledge["probability"];
      }
      if (q.includes('trigonometry') || q.includes('trig')) {
        return mathKnowledge["trigonometry"];
      }
      if (q.includes('mean') || q.includes('average')) {
        return mathKnowledge["mean"];
      }
      if (q.includes('median')) {
        return mathKnowledge["median"];
      }
      if (q.includes('mode')) {
        return mathKnowledge["mode"];
      }
      if (q.includes('add') || q.includes('addition') || q.includes('sum')) {
        return mathKnowledge["addition"];
      }
      if (q.includes('subtract') || q.includes('subtraction') || q.includes('difference')) {
        return mathKnowledge["subtraction"];
      }
      if (q.includes('multiply') || q.includes('multiplication') || q.includes('product') || q.includes('times')) {
        return mathKnowledge["multiplication"];
      }
      if (q.includes('divide') || q.includes('division') || q.includes('quotient')) {
        return mathKnowledge["division"];
      }
      if (q.includes('square root') || q.includes('sqrt')) {
        return mathKnowledge["square root"];
      }
      if (q.includes('exponent') || q.includes('power')) {
        return mathKnowledge["exponents"];
      }
      if (q.includes('equation')) {
        return mathKnowledge["equations"];
      }
      if (q.includes('variable')) {
        return mathKnowledge["variables"];
      }
      if (q.includes('function')) {
        return mathKnowledge["functions"];
      }
      if (q.includes('factor')) {
        return mathKnowledge["factors"];
      }
      if (q.includes('multiple')) {
        return mathKnowledge["multiples"];
      }
      if (q.includes('fibonacci')) {
        return mathKnowledge["fibonacci sequence"];
      }
      if (q.includes('matrix') || q.includes('matrices')) {
        return mathKnowledge["matrices"];
      }
      if (q.includes('vector')) {
        return mathKnowledge["vectors"];
      }
      if (q.includes('complex number')) {
        return mathKnowledge["complex numbers"];
      }
      if (q.includes('logarithm') || q.includes('log')) {
        return mathKnowledge["logarithms"];
      }
      if (q.includes('sin') && !q.includes('using') && !q.includes('cosine')) {
        return mathKnowledge["sine"];
      }
      if (q.includes('cos')) {
        return mathKnowledge["cosine"];
      }
      if (q.includes('tan') && !q.includes('constant')) {
        return mathKnowledge["tangent"];
      }
      if (q.includes('area')) {
        return mathKnowledge["area"];
      }
      if (q.includes('volume')) {
        return mathKnowledge["volume"];
      }
      if (q.includes('perimeter')) {
        return mathKnowledge["perimeter"];
      }
      if (q.includes('angle')) {
        return mathKnowledge["angles"];
      }
      if (q.includes('integer')) {
        return mathKnowledge["integers"];
      }
      if (q.includes('rational')) {
        return mathKnowledge["rational numbers"];
      }
      if (q.includes('irrational')) {
        return mathKnowledge["irrational numbers"];
      }
      if (q.includes('even') && q.includes('number')) {
        return mathKnowledge["even numbers"];
      }
      if (q.includes('odd') && q.includes('number')) {
        return mathKnowledge["odd numbers"];
      }
      if (q.includes('decimal')) {
        return mathKnowledge["decimals"];
      }
      if (q.includes('polynomial')) {
        return mathKnowledge["polynomials"];
      }
      if (q.includes('quadratic')) {
        return mathKnowledge["quadratic equations"];
      }
      if (q.includes('limit')) {
        return mathKnowledge["limits"];
      }
      if (q.includes('series')) {
        return mathKnowledge["series"];
      }
      if (q.includes('absolute value')) {
        return mathKnowledge["absolute value"];
      }
      if (q.includes('order of operations') || q.includes('pemdas') || q.includes('bodmas')) {
        return mathKnowledge["order of operations"];
      }
      if (q.includes('gcd') || q.includes('greatest common')) {
        return mathKnowledge["greatest common divisor"];
      }
      if (q.includes('perfect square')) {
        return mathKnowledge["perfect squares"];
      }
      if (q.includes('composite')) {
        return mathKnowledge["composite numbers"];
      }
      if (q.includes('pi') || q.includes('œÄ')) {
        return mathKnowledge["pi"];
      }
      
      // Generic helpful response
      return `Great question! I can help you with many math topics including:\n\nüìä Basic Math: prime numbers, fractions, decimals, percentages\nüìê Geometry: triangles, circles, area, volume, Pythagorean theorem\nüî¢ Algebra: equations, variables, polynomials, exponents\nüìà Calculus: derivatives, integrals, limits\nüìâ Statistics: mean, median, mode, probability\n‚ûï Operations: addition, subtraction, multiplication, division\n\nTry asking something like "What are prime numbers?" or "Explain the Pythagorean theorem"`;
    }
    
    function explainCalculation(calculation) {
      // Extract calculation details
      const match = calculation.match(/(\d+\.?\d*)\s*([+\-√ó√∑])\s*(\d+\.?\d*)\s*=\s*(\d+\.?\d*)/);
      
      if (match) {
        const [_, num1, op, num2, result] = match;
        const operations = {
          '+': 'addition',
          '‚àí': 'subtraction',
          '√ó': 'multiplication',
          '√∑': 'division'
        };
        
        let explanation = `Great! You performed ${operations[op]}. `;
        
        if (op === '+') {
          explanation += `When you add ${num1} and ${num2}, you get ${result}. Addition combines two numbers to find their total sum. It's one of the four basic arithmetic operations and represents combining quantities together.`;
        } else if (op === '‚àí') {
          explanation += `When you subtract ${num2} from ${num1}, you get ${result}. Subtraction finds the difference between two numbers and tells you how much is left or how much more one number is than another.`;
        } else if (op === '√ó') {
          explanation += `When you multiply ${num1} by ${num2}, you get ${result}. Multiplication is repeated addition - it's like adding ${num1} to itself ${num2} times, which gives us ${result}.`;
        } else if (op === '√∑') {
          explanation += `When you divide ${num1} by ${num2}, you get ${result}. Division splits a number into equal parts. Here, we're finding how many groups of ${num2} fit into ${num1}, which is ${result}.`;
        }
        
        return explanation;
      }
      
      // Handle special functions
      if (calculation.includes('‚àö')) {
        return `You calculated a square root! The square root finds a number that, when multiplied by itself, gives the original number. Square roots are the inverse operation of squaring a number.`;
      }
      if (calculation.includes('¬≤')) {
        return `You squared a number! Squaring means multiplying a number by itself. It's used in many formulas, especially in geometry for calculating areas.`;
      }
      if (calculation.includes('%')) {
        return `You calculated a percentage! Percentages express numbers as parts of 100. They're useful for comparing proportions, calculating discounts, interest rates, and statistics.`;
      }
      if (calculation.includes('1/')) {
        return `You calculated a reciprocal! The reciprocal of a number is 1 divided by that number. Reciprocals are useful in division and fraction operations.`;
      }
      
      return `You calculated: ${calculation}. Great job using the calculator!`;
    }

    const displayEl = document.getElementById('display');
    const historyEl = document.getElementById('history');
    const chatArea = document.getElementById('chatArea');
    const aiInput = document.getElementById('aiInput');
    const sendBtn = document.getElementById('sendBtn');
    const equationInput = document.getElementById('equationInput');
    const solveBtn = document.getElementById('solveBtn');
    const solutionContent = document.getElementById('solutionContent');
    const memoryList = document.getElementById('memoryList');
    const historyList = document.getElementById('historyList');
    const clearHistoryBtn = document.getElementById('clearHistoryBtn');
    const clearMemoryBtn = document.getElementById('clearMemoryBtn');
    const historyToggle = document.getElementById('historyToggle');

    // Panel tab switching
    document.querySelectorAll('.panel-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.panel-content').forEach(c => c.classList.remove('active'));
        
        this.classList.add('active');
        const tabName = this.dataset.tab;
        document.getElementById(tabName + 'Panel').classList.add('active');
        
        if (tabName === 'history') {
          updateHistoryDisplay();
          updateMemoryDisplay();
        }
      });
    });

    historyToggle.onclick = function() {
      document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.panel-content').forEach(c => c.classList.remove('active'));
      document.querySelector('.panel-tab[data-tab="history"]').classList.add('active');
      document.getElementById('historyPanel').classList.add('active');
      updateHistoryDisplay();
      updateMemoryDisplay();
    };

    function updateHistoryDisplay() {
      if (calculationHistory.length === 0) {
        historyList.innerHTML = '<div class="no-history">No calculations yet</div>';
      } else {
        historyList.innerHTML = calculationHistory.map((item, index) => `
          <div class="history-item" data-index="${index}">
            <div class="history-expression">${item.expression}</div>
            <div class="history-result">= ${item.result}</div>
          </div>
        `).reverse().join('');
        
        document.querySelectorAll('.history-item').forEach(item => {
          item.addEventListener('click', function() {
            const index = parseInt(this.dataset.index);
            useHistoryResult(index);
          });
        });
      }
    }

    function useHistoryResult(index) {
      const item = calculationHistory[calculationHistory.length - 1 - index];
      setDisplay(item.result);
      document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.panel-content').forEach(c => c.classList.remove('active'));
      document.querySelector('.panel-tab[data-tab="chatgpt"]').classList.add('active');
      document.getElementById('chatgptPanel').classList.add('active');
    }

    clearHistoryBtn.onclick = function() {
      calculationHistory = [];
      updateHistoryDisplay();
    };

    clearMemoryBtn.onclick = function() {
      memoryVal = 0;
      updateMemoryDisplay();
    };

    function updateMemoryDisplay() {
      if (memoryVal === 0) {
        memoryList.innerHTML = '<div class="no-memory">No memory stored</div>';
      } else {
        memoryList.innerHTML = `<div class="memory-item" id="memoryItem">M = ${memoryVal}</div>`;
        document.getElementById('memoryItem').addEventListener('click', useMemoryValue);
      }
    }

    function useMemoryValue() {
      setDisplay(String(memoryVal));
      document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.panel-content').forEach(c => c.classList.remove('active'));
      document.querySelector('.panel-tab[data-tab="chatgpt"]').classList.add('active');
      document.getElementById('chatgptPanel').classList.add('active');
    }

    function setDisplay(val) {
      currentVal = String(val);
      displayEl.value = currentVal;
    }

    function setHistory(text) {
      historyEl.textContent = text || '\u00A0';
    }

    function addMessage(text, isUser) {
      const msgDiv = document.createElement('div');
      msgDiv.className = 'message ' + (isUser ? 'user-message' : 'ai-message');
      msgDiv.textContent = text;
      chatArea.appendChild(msgDiv);
      chatArea.scrollTop = chatArea.scrollHeight;
    }

    function showLoading() {
      const loadDiv = document.createElement('div');
      loadDiv.className = 'loading';
      loadDiv.id = 'loadingMsg';
      loadDiv.innerHTML = '<span style="animation: pulse 1.5s ease-in-out infinite;">‚óè</span> Claude is thinking...';
      chatArea.appendChild(loadDiv);
      chatArea.scrollTop = chatArea.scrollHeight;
    }

    function removeLoading() {
      const loadDiv = document.getElementById('loadingMsg');
      if (loadDiv) loadDiv.remove();
    }

    async function askChatGPT(question, isCalculation = false) {
      try {
        showLoading();
        
        // Build prompt based on context
        let userMessage = question;
        let systemPrompt = "You are a comprehensive math tutor and calculator assistant. You can explain ANY mathematical concept, from basic arithmetic to advanced mathematics. When users ask 'what is X' or 'explain Y', provide clear, detailed explanations with examples. Topics include: prime numbers, fractions, algebra, geometry, calculus, trigonometry, statistics, number theory, and more. When explaining calculations, be brief (2-3 sentences). For concept questions, provide thorough explanations with examples and real-world applications. Always be educational, clear, and encouraging.";
        
        if (isCalculation) {
          userMessage = `I just performed this calculation: ${question}. Please explain it briefly and clearly in 2-3 sentences.`;
        }
        
        // Add to conversation history
        conversationHistory.push({
          role: "user",
          content: userMessage
        });
        
        // Call Claude API
        const response = await fetch("https://api.anthropic.com/v1/messages", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "claude-sonnet-4-20250514",
            max_tokens: 2000,
            system: systemPrompt,
            messages: conversationHistory
          })
        });

        if (!response.ok) {
          throw new Error(`API Error: ${response.status}`);
        }

        const data = await response.json();
        
        // Check for API errors
        if (data.error) {
          throw new Error(data.error.message || "API request failed");
        }
        
        // Extract response text
        let aiResponse = '';
        if (data.content && data.content.length > 0) {
          aiResponse = data.content
            .filter(item => item.type === "text")
            .map(item => item.text)
            .join("\n");
        }
        
        if (!aiResponse) {
          throw new Error("Empty response from API");
        }
        
        // Add AI response to conversation history
        conversationHistory.push({
          role: "assistant",
          content: aiResponse
        });
        
        // Keep conversation history manageable (last 12 messages)
        if (conversationHistory.length > 12) {
          conversationHistory = conversationHistory.slice(-12);
        }
        
        removeLoading();
        addMessage(aiResponse, false);
        
      } catch (error) {
        console.error("API Error:", error);
        removeLoading();
        
        // Remove the failed user message from history
        if (conversationHistory.length > 0 && conversationHistory[conversationHistory.length - 1].role === "user") {
          conversationHistory.pop();
        }
        
        // Provide helpful error message based on error type
        let errorMessage = '';
        
        if (error.message.includes('API Error') || error.message.includes('Failed to fetch')) {
          errorMessage = "‚ö†Ô∏è AI Connection Error: The Claude AI service is currently unavailable. This calculator works best when used directly on claude.ai. You can still use all calculator functions normally!";
        } else {
          errorMessage = "‚ö†Ô∏è Oops! I encountered an issue. Please try again or rephrase your question. The calculator functions work perfectly!";
        }
        
        addMessage(errorMessage, false);
      }
    }

    async function solveChatGPT(equation) {
      try {
        solveBtn.disabled = true;
        solutionContent.textContent = 'Claude is solving your equation...';
        
        // Call Claude API for equation solving
        const response = await fetch("https://api.anthropic.com/v1/messages", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "anthropic-version": "2023-06-01"
          },
          body: JSON.stringify({
            model: "claude-sonnet-4-20250514",
            max_tokens: 1000,
            system: "You are a math tutor helping solve equations. Provide step-by-step solutions with clear explanations. Format your response with headers like 'Step 1:', 'Step 2:', etc. Show all work and verify the solution at the end.",
            messages: [
              {
                role: "user",
                content: `Please solve this equation step-by-step: ${equation}

Provide:
1. The complete step-by-step solution
2. Explanation of each step
3. Verification of the answer
4. The final answer clearly marked

Format it clearly with headers and steps.`
              }
            ]
          })
        });

        const data = await response.json();
        
        // Check for API errors
        if (data.error) {
          console.error("API Error:", data.error);
          throw new Error(data.error.message || "API request failed");
        }
        
        // Extract solution text
        let solution = '';
        if (data.content && Array.isArray(data.content) && data.content.length > 0) {
          solution = data.content
            .filter(item => item.type === "text")
            .map(item => item.text)
            .join("\n");
        }
        
        if (!solution) {
          throw new Error("No solution content received");
        }
        
        solutionContent.textContent = solution;
        
      } catch (error) {
        console.error("Equation solver error:", error);
        
        const errorMessage = `ü§ñ Claude AI Equation Solver

This feature uses Claude AI to solve equations with step-by-step explanations!

‚úÖ Works perfectly in claude.ai where Claude can:
‚Ä¢ Solve any equation (linear, quadratic, systems, etc.)
‚Ä¢ Show detailed step-by-step solutions
‚Ä¢ Explain each step clearly
‚Ä¢ Verify the answers

üì± To use this feature:
1. Use this calculator in claude.ai
2. Or ask your equation in the AI Assistant chat tab
3. I'll solve it with full explanations!

üí° The calculator buttons work perfectly everywhere!`;
        
        solutionContent.textContent = errorMessage;
      } finally {
        solveBtn.disabled = false;
      }
    }

    sendBtn.onclick = async function() {
      const question = aiInput.value.trim();
      if (!question) return;
      
      addMessage(question, true);
      aiInput.value = '';
      sendBtn.disabled = true;
      
      await askChatGPT(question);
      sendBtn.disabled = false;
    };

    aiInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        sendBtn.click();
      }
    });

    solveBtn.onclick = function() {
      const equation = equationInput.value.trim();
      if (!equation) {
        solutionContent.textContent = 'Please enter an equation first!';
        return;
      }
      solveChatGPT(equation);
    };

    equationInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        solveBtn.click();
      }
    });

    function inputDigit(digit) {
      if (waitingForOperand) {
        setDisplay(digit);
        waitingForOperand = false;
      } else {
        setDisplay(currentVal === '0' ? digit : currentVal + digit);
      }
    }

    function inputDecimal() {
      if (waitingForOperand) {
        setDisplay('0.');
        waitingForOperand = false;
      } else if (currentVal.indexOf('.') === -1) {
        setDisplay(currentVal + '.');
      }
    }

    function clearAll() {
      setDisplay('0');
      setHistory('');
      previousVal = null;
      operator = null;
      waitingForOperand = false;
    }

    function clearEntry() {
      setDisplay('0');
    }

    function backspace() {
      const newVal = currentVal.slice(0, -1);
      setDisplay(newVal || '0');
    }

    function performOperation(nextOperator) {
      const inputValue = parseFloat(currentVal);

      if (previousVal === null) {
        previousVal = inputValue;
      } else if (operator) {
        const result = calculate(previousVal, inputValue, operator);
        setDisplay(String(result));
        previousVal = result;
      }

      waitingForOperand = true;
      operator = nextOperator;
      
      const opSymbol = {
        'ADD': '+',
        'SUBTRACT': '‚àí',
        'MULTIPLY': '√ó',
        'DIVIDE': '√∑'
      }[nextOperator];
      
      setHistory(previousVal + ' ' + opSymbol);
    }

    function calculate(firstOperand, secondOperand, op) {
      switch(op) {
        case 'ADD':
          return firstOperand + secondOperand;
        case 'SUBTRACT':
          return firstOperand - secondOperand;
        case 'MULTIPLY':
          return firstOperand * secondOperand;
        case 'DIVIDE':
          if (secondOperand === 0) {
            setHistory('');
            return 'Cannot divide by zero';
          }
          return firstOperand / secondOperand;
        default:
          return secondOperand;
      }
    }

    function performEquals() {
      const inputValue = parseFloat(currentVal);

      if (previousVal !== null && operator) {
        const result = calculate(previousVal, inputValue, operator);
        
        const opSymbol = {
          'ADD': '+',
          'SUBTRACT': '‚àí',
          'MULTIPLY': '√ó',
          'DIVIDE': '√∑'
        }[operator];
        
        const expression = previousVal + ' ' + opSymbol + ' ' + inputValue;
        lastCalculation = expression + ' = ' + result;
        
        calculationHistory.push({
          expression: expression,
          result: result
        });
        
        setHistory(lastCalculation);
        setDisplay(String(result));
        
        // Check for 9/11 easter egg
        const is911 = (previousVal === 9 && inputValue === 11 && operator === 'DIVIDE');
        
        addMessage(`I just calculated: ${lastCalculation}`, true);
        askChatGPT(`Explain this calculation briefly: ${lastCalculation}. Keep it simple and short.`, true);
        
        // Add airplane emoji for 9/11
        if (is911) {
          setTimeout(() => {
            const emojiDiv = document.createElement('div');
            emojiDiv.className = 'message ai-message';
            emojiDiv.style.fontSize = '48px';
            emojiDiv.style.textAlign = 'center';
            emojiDiv.textContent = '‚úàÔ∏è';
            chatArea.appendChild(emojiDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
          }, 1500);
        }
        
        previousVal = null;
        operator = null;
        waitingForOperand = true;
      }
    }

    function performFunction(fn) {
      const inputValue = parseFloat(currentVal);
      let result;
      let explanation = '';

      switch(fn) {
        case 'PERCENT':
          result = inputValue / 100;
          explanation = `${inputValue}% = ${result}`;
          break;
        case 'RECIPROCAL':
          if (inputValue === 0) {
            result = 'Cannot divide by zero';
          } else {
            result = 1 / inputValue;
            explanation = `1/${inputValue} = ${result}`;
          }
          break;
        case 'SQUARE':
          result = inputValue * inputValue;
          explanation = `${inputValue}¬≤ = ${result}`;
          break;
        case 'SQRT':
          if (inputValue < 0) {
            result = 'Invalid input';
          } else {
            result = Math.sqrt(inputValue);
            explanation = `‚àö${inputValue} = ${result}`;
          }
          break;
        case 'NEGATE':
          result = -inputValue;
          break;
      }

      setDisplay(String(result));
      
      if (fn !== 'NEGATE' && explanation) {
        addMessage(`I just calculated: ${explanation}`, true);
        askChatGPT(`Explain this calculation briefly: ${explanation}. Keep it simple and short.`, true);
      }
      
      if (fn !== 'NEGATE') {
        waitingForOperand = true;
      }
    }

    // Number buttons
    document.getElementById('n0').onclick = () => inputDigit('0');
    document.getElementById('n1').onclick = () => inputDigit('1');
    document.getElementById('n2').onclick = () => inputDigit('2');
    document.getElementById('n3').onclick = () => inputDigit('3');
    document.getElementById('n4').onclick = () => inputDigit('4');
    document.getElementById('n5').onclick = () => inputDigit('5');
    document.getElementById('n6').onclick = () => inputDigit('6');
    document.getElementById('n7').onclick = () => inputDigit('7');
    document.getElementById('n8').onclick = () => inputDigit('8');
    document.getElementById('n9').onclick = () => inputDigit('9');
    document.getElementById('decimal').onclick = () => inputDecimal();

    // Operator buttons
    document.getElementById('add').onclick = () => performOperation('ADD');
    document.getElementById('subtract').onclick = () => performOperation('SUBTRACT');
    document.getElementById('multiply').onclick = () => performOperation('MULTIPLY');
    document.getElementById('divide').onclick = () => performOperation('DIVIDE');
    document.getElementById('equals').onclick = () => performEquals();

    // Function buttons
    document.getElementById('clear').onclick = () => clearAll();
    document.getElementById('ce').onclick = () => clearEntry();
    document.getElementById('back').onclick = () => backspace();
    document.getElementById('percent').onclick = () => performFunction('PERCENT');
    document.getElementById('recip').onclick = () => performFunction('RECIPROCAL');
    document.getElementById('square').onclick = () => performFunction('SQUARE');
    document.getElementById('sqrt').onclick = () => performFunction('SQRT');
    document.getElementById('negate').onclick = () => performFunction('NEGATE');

    // Memory buttons
    document.getElementById('mc').onclick = () => {
      memoryVal = 0;
      updateMemoryDisplay();
    };
    
    document.getElementById('mr').onclick = () => {
      setDisplay(String(memoryVal));
    };
    
    document.getElementById('mAdd').onclick = () => {
      memoryVal += parseFloat(currentVal);
      updateMemoryDisplay();
    };
    
    document.getElementById('mSub').onclick = () => {
      memoryVal -= parseFloat(currentVal);
      updateMemoryDisplay();
    };
    
    document.getElementById('ms').onclick = () => {
      memoryVal = parseFloat(currentVal);
      updateMemoryDisplay();
    };
  </script>
</body>
</html>
